timeline:
9 at new game
13 when Lib awakens
15 when Renier arrives
17 when others arrive
18 after the plan
20 when they get back

// I was previously thinking you couldn't move a dead character's data; Moni came out not because that was her last location, but because it was the one she remembered.
	-- i don't think it's true. I think you can move a dead char's data; otherwise Adam would've been way more reluctant to break restore_character.

// Maybe at the end of it all, it'll say emergency purge while it's killing everyone, since that phrase is familiar.

.. it's an acceptable loss that how shocking it is to regain your memories is wildly inconsistent.

// maybe Moni should break restore_area when she mentions wanting to make an invalid area.
// maybe she should also break Character.suppressed. The player would suggest it if she forgot.

// Maybe Lib caused the 13 year gap. 13 years passed outside but not in?

# Adam talks about Ursula's poem
k "\"To see the future is to be wise.\""
k "I believed this."
k "And so I did horrible things for the sake of the future."
k "But then..."
k "... I did something horrible for the sake of myself."
k "The words became an excuse for all the horrible things I did."
k "..."
k "I always thought the meaning of the first sentence related to her thoughts as she decided to leave."
k "The rich aroma was the prospects of entering [persistent.playername]'s world, the bittersweet aftertaste was the people she would have to leave behind, and the hot, complex balance was the pain of the decision."
k "On the surface, it seems that couldn't have been the intended meaning, because she wrote it before then."
k "Or..."
k "... did she?"
k "After all, we know that in DDLC, Linda wrote ."
k "And we never found the poem until after Ursula was gone."
k "So it's not out of the question that, in fact, she {i}did{/i} write it with those thoughts in mind."

# Adam talks about code
k "Whenever you use the Python wrappers, the interpreter enters the block of instructions for the function, and then tries to evaluate its arguments."
k "When it evaluates Ursula's Character object and finds that it's invalid..."
k "... the game marks the whole region it was in as off-limits, and deletes any references to it."

k "But checking the number of arguments happens before that - which is why this can't be used to break functions that don't take any arguments."

k "We know from experience that the Third Eye interacts with nearby admins."
k "For example, I'm sure [persistent.playername] saw how being caught in Libitina's distortion during your great escape affected my console, causing everything I typed to come out as glitch text."

# Linda explains Character.reset / restore_character work
l "Internally, restore_character uses Character.reset."
l "restore_character is essentially a wrapper that resets a character and marks them as alive."
l "And restores their file, of course."

#
    menu:
        " "
        "Don't make me break admin.jail! - Adam":
            pass

    "It bought me all the time I needed."
    "My hack is complete."
    "It just needs one certain thing to happen to make an opening."

    menu:
        " "
        "I sent you to the warehouse because I just needed to buy time to finish my hack. - Adam":
            pass
    menu:
        " "
        "But it actually finished... and it didn't work anyway. - Adam":
            pass
    l "Wait..."
    l "... even though viewport.set_memory_protection was a fake?"
    menu:
        " "
        "Yes, it was. - Adam":
            pass
    menu:
        " "
        "I don't know why it doesn't work. - Adam":
            pass

    show albert at std
    mc "I guess... that makes sense."
    "We all nod in agreement."
    mc "Alright..."
    mc "I guess I'm sticking around here then."
    "Part of me is really disappointed that I'm not ."
    mc ""
    #XXX
    y "Um..."
    y "Did anyone else notice that he implied he thought of making Libitina an admin long before he discovered VR?"
    y "That means there must be a way to do it without, right?"
    "Yeah... there must be."
    "But it wouldn't help now."
    ""
    "Besides, he'll definitely have broken it."

# Possible planning in ch27
    "Is there a way we can get Libitina into DDLC?"
    "Hey..."
    "I thought of something."
    "If Libitina could be in DDLC when Adam goes in, ."
    # No, this wouldn't work because he wouldn't need to deal with her.


# Albert's reaction to hearing about the plan to use Libitina's Third Eye in ch24
    al 12111 "Let me get this straight..."
    al "Your plan is actually to have Libitina stab one of you so that she can lose control and hopefully do something good?"
    show albert at std
    l "Yep."
    show albert at foc
    al c21513 "This is the worst plan I've ever heard!"
    if ch22_libitina_has_gun():
        al "Even worse than shooting Natsuki in the invalid area!"
    else:
        al "Even worse than Natsuki shooting herself in the invalid area!"
    al "At least her death was instant..."
    al "We can't just do this!"
    show albert at std
    show monika at foc
    m "We can."
    show monika at std
    show albert at foc
    al "There must be another way!"
    show albert at std
    show monika at foc
    m "There isn't."
    show monika at std
    show renier at foc
    r ""
    show renier at std

# Possible plothole with the escape
    "Adam must've not been there."
    "Wait a minute..."
    "warp was broken, but there were other ways ."
    "According to the book she compiled, Linda read his memories a long time after that point."
    "Is it really possible he didn't know about memory reading?"

# For the penultimate scene of ch26
#    m "I can't make him POV since his POV flag is broke, and even if I did, that wouldn't help."
    # Monika could read his memories to know his intentions.
    k "[persistent.playername], we need you to restart the viewport."
    k "I can't even crash the game..."
    m "So you're admitting it now...?"
    m "You really do still want to cut us off from [persistent.playername] so you can go back to being evil?"
    k "No!"
    k "I swear!"
    k "I..."
    k "I have to be honest."
    k "I am trying to cut you off from [persistent.playername]."
    k "But I ."
#    m "It's still not correcting itself..."
#    k "It probably takes a restart."
#    $ persistent.autoload = 'returned_to_ddlc_2'
#    k "[persistent.playername]..."
    # Couldn't he win now by deleting Monika?
    # Might just need Monika to extract herself?
    # Maybe neither extract nor delete work until VP restart.
    # He's only saying this bc his pretense is that he's keeping options open.
    # Maybe someone else should, but they don't have anything to gain really.
    # Honestly I don't know why he would want to say it.
    menu:
        " "
        "I want you to know, I just tried putting Monika into DDLC like Sayori suggested. - Adam":
            pass
    menu:
        " "
        "But she isn't coming out... - Adam":
            pass
    s "We're not believing a word of what you say!"
    
    menu:
        " "
        "Maybe putting her in DDLC didn't fix her console. She's still messed up from Libitina's distortion.":
            pass
    menu:
        " "
        "True... - Adam":
            pass
    menu:
        " "
        "I think I have to go into DDLC myself to reset her. - Adam":
            pass
    menu:
        " "
        "If she's still in that horrid glitched state... I have to save her from it. - Adam":
            pass



    menu:
        ""
        "I will shoot myself in the forehead. - Adam":
            pass
            # Oh, if they restore Monika, they'll want to go back to get her.
    # TODO Why does he actually tell this lie?
    # Maybe someone else does.
    # But doesn't he just admit he's going to shoot himself?
    # Maybe one of the GGs is worried about him killing himself, and he slips that he already tried.
    menu:
        " "
        "It's faster if I come to you and let you knock me out like you did with Monika than if I try to fall asleep. - Adam":
            pass
    menu:
        " "
        "I'd do that, but you'll shoot me on sight... - Adam":
            pass
    s "We won't shoot you on sight!"
    s "If you're really the only way we can save Monika... then we're not stupid."
    if persistent.player_advocate_mercy[0]:
        s "I want to torture you."
        s "I want to see you bleed and cry, just like you did to us..."
        "Sayori sniffles."
        s "But I'm not stupid."
        $ temp = "There's no way you'd be that stupid"
    else:
        s "We've worked with people who did horrible things before!"
        $ temp = "I should trust you"
    menu:
        " "
        "... - Adam":
            pass
    menu:
        " "
        "You're right. [temp]. Dammit. I'll meet you. - Adam":
            pass
    menu:
        " "
        "Take road 27 and pull over a good half a mile out of the city limits to make sure you're safe. - Adam":
            pass
    menu:
        " "
        "I will be there. - Adam":
            pass
    r "He's just sending us on another goddamn goose chase!"
    r "He's not gonna be there, and we'll lose even more time!"
    #
    show albert at std
    mc "I guess... that makes sense."
    "We all nod in agreement."
    mc "Alright..."
    mc "I guess I'm sticking around here then."
    "Part of me is really disappointed that I'm not ."
    mc ""
    #XXX
    y "Um..."
    y "Did anyone else notice that he implied he thought of making Libitina an admin long before he discovered VR?"
    y "That means there must be a way to do it without, right?"
    "Yeah... there must be."
    "But it wouldn't help now."
    ""
    "Besides, he'll definitely have broken it."



    "Is there a way we can get Libitina into DDLC?"
    "Hey..."
    "I thought of something."
    "If Libitina could be in DDLC when Adam goes in, ."
    # No, this wouldn't work because he wouldn't need to deal with her.




    al 12111 "Let me get this straight..."
    al "Your plan is actually to have Libitina stab one of you so that she can lose control and hopefully do something good?"
    show albert at std
    l "Yep."
    show albert at foc
    al c21513 "This is the worst plan I've ever heard!"
    if ch22_libitina_has_gun():
        al "Even worse than shooting Natsuki in the invalid area!"
    else:
        al "Even worse than Natsuki shooting herself in the invalid area!"
    al "At least her death was instant..."
    al "We can't just do this!"
    show albert at std
    show monika at foc
    m "We can."
    show monika at std
    show albert at foc
    al "There must be another way!"
    show albert at std
    show monika at foc
    m "There isn't."
    show monika at std
    show renier at foc
    r ""
    show renier at std
    #

#    "Adam must've not been there."
#    "Wait a minute..."
#    "warp was broken, but there were other ways ."
#    "According to the book she compiled, Linda read his memories a long time after that point."
#    "Is it really possible he didn't know about memory reading?"






    # TODO who should speak?
    "Wait, hey Adam!"
    "Can't you just shoot yourself in the forehead?"
    "That would be the fastest."
    "Admins only get messed up if they're killed by the Third Eye, right?" # maybe he should say he already tried?
    # They wouldn't suggest this because they want to meet him.
    # Maybe they don't say it to him but he hears.
    # Why doesn't he want them to think he's doing that.
    menu:
        " "
        "No, it happens regardless of how we die. - Adam":
            pass
    "That's not true!"
    "Monika, Sayori {i}and{/i} Linda have got killed before in other ways and it didn't mess them up!"
    "..."
    ""
    menu:
        " "
        "... I forgot about that. - Adam":
            pass
    menu:
        " "
        "Guess I would've been better off not answering. - Adam":
            pass
    s "You just lied!"
    s "So much for you convincing us you have good intentions now!"
    menu:
        " "
        "I do! Like I said, I'm not going to do any more horrible things... - Adam":
            pass





    # TODO
    "Wait..."
    "If his win condition now is killing the POV character..."
    "... and we learned that broken APIs work inside DDLC..."
    "... what stops him from killing himself, putting himself in DDLC, making himself POV, then coming out and killing himself again?"
    "The only reason he can't do that without DDLC is because he broke the Character.pov flag, right?"
    "And admins only get their consoles messed up if they're killed by a Third Eye."
    "We know that from experience."

#    "But if he really wants to save Monika without turning himself in to us, shooting himself is the faster and better plan."
#    "It's more in accord with his goals."
#    "So why did he lie to get an excuse not to do it?"
#    "..."



    "It looks like the viewport is still trying to follow [vpchar], and it's errorirng out because he's not here."

    k "But why did this happen?"
    k "The viewport shouldn't be able to stop us from..."
    k "Ugh..."
    k "Unless it happened during the connection phase."
    k "Another bug I didn't think about."
    menu:
        " "
        "We're in trouble, Monika. He wins if he kills the POV character.":
            pass
    "Wait what...?"
    "You stupid idiot, [persistent.playername]!"
    "You needed him not to kill the POV character, so you pointed the viewport over here so POV stuff became available again?"
    "Now all he has to do is..."
    call updateconsole("c=admin.extract_character(monika)")
    call updateconsole("c=admin.extract_character(monika)")
    "Wait why's he trying to extract me instead of delete me?"

    # I just need a reason why extract doesn't work, but other things do.
    ""

    
    call updateconsole("import viewport")
    "... make me POV and then delete me again!"
    "Point the viewport back!!!"
    menu:
        " "
        "Wait, I've got it! Don't click this!": # this strat only makes sense if you had time to explain...
            pass
    # Doesn't the player .
    menu:
        " "
        "Negative, that would make him win. We have to buy more time.":
            pass
    call updateconsole("vp = viewport.get_viewport()")
    "I might be able to slow him down...!"
    "I just have to stop him from deleting me while I'm POV!"
    "Now that the viewport is back over here, it should let me switch {i}his{/i} flag on!"
    call updateconsole("adam.pov=True")
    call updateconsole("vp.pov_character = monika", "POV changed to Monika")
    "He just set it to me..."
    "But I can make it him before he deletes me!"
    call updateconsole("vp.pov_character = adam", "POV changed to Adam")
    call updateconsole("delete_character(monika)", "Monika deleted successfully")
    $ temp1, temp2, temp3 = glitchtext(30), glitchtext(20), glitchtext(15)
    "[temp]"
    "[temp2]Crap[temp3]"

    
    k "I don't get it..."
    "{cps=200}Fatal error: player character missing.{/cps}"
    k "... It's stuck."
    "{cps=200}Fatal error: player character missing.{/cps}"
    m "[persistent.playername]?"
    m "You set the viewport back to DDLC...?"
    "{cps=200}Fatal error: player character missing.{/cps}"
    k "It looks like it."
    k "Because the POV character is still set to [vpchar], but he's not here, so it can't work."
    menu:
        " "
        "What happened here?":
            pass
    m "Adam reset me."
    m "He really did."
    menu:
        " "
        "We're in trouble, Monika. He wins if he kills the POV character.":
            pass
    m "What...?"
    k "[persistent.playername], I promise, I'm not even trying to cut you out of the picture anymore!"
    "{cps=200}Fatal error: player character missing.{/cps}"
    k "I think we just need to set one of us as POV to fix the error so we can extract."
    "{cps=200}Fatal error: player character missing.{/cps}"
    call updateconsole("import viewport")
    call updateconsole("vp = viewport.get_viewport()")
    call updateconsole("vp.pov_character = monika", "POV changed to Monika") # This, as well as Character.pov, only work if the viewport is connected.
    "{cps=200}Fatal error: player character missing.{/cps}"
    "Wait... you said he wins if he kills the POV character?!?"
    "He just made me POV and delete_character isn't broken in here!"
    "I have to get myself out!"
    call updateconsole("ch = admin.extract_character(monika)")
    call updateconsole("sig = pgp_sign(ch, markov_key)")
    call updateconsole("admin.complete_action(sig)", "Action failed: Invalid state")
    m "Ah...!"
    "{cps=200}Fatal error: player character missing.{/cps}"
#    call updateconsole("delete_character(monika)", "Action failed: Invalid state")
    k "It won't work while the world is stuck like this."
    k "Even though we gave it a valid POV character, we still need to make it update."
    k "It probably takes a restart."
    "{cps=200}Fatal error: player character missing.{/cps}"
    menu:
        " "
        "Monika, be VERY careful. If he deletes you now, we lose.":
            pass
    "{cps=200}Fatal error: player character missing.{/cps}"
    m "What happened while we were waiting for you to switch back?"
    "{cps=200}Fatal error: player character missing.{/cps}"
    m "As long as the world is stuck like this, I don't think he can do anything dangerous..."
    m "... or he would've already, if he was going to."
    "{cps=200}Fatal error: player character missing.{/cps}"
    m "So it's safe to take time to explain."
    "{cps=200}Fatal error: player character missing.{/cps}"
    menu:
        " "
        "[explain events since Monika's death]":
            pass
    m "I see."
    m "So we do lose if I get deleted."
    "{cps=200}Fatal error: player character missing.{/cps}"
    # TODO why does the player shut off, or does Adam do it?
    $ renpy.quit()

